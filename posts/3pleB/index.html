<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cem Sirin">
<meta name="dcterms.date" content="2023-03-26">
<meta name="description" content="A detailed explanation of the triple barrier method, a method to label data for asset price prediction.">

<title>Cem Sirin - The triple barrier method</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../../site_libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Cem Sirin</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cem-sirin"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The triple barrier method</h1>
                  <div>
        <div class="description">
          A detailed explanation of the triple barrier method, a method to label data for asset price prediction.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">labelling</div>
                <div class="quarto-category">machine learning</div>
                <div class="quarto-category">quantitative finance</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Cem Sirin </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 26, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#contents" id="toc-contents" class="nav-link active" data-scroll-target="#contents">Contents</a></li>
  <li><a href="#introducing-the-triple-barrier-method" id="toc-introducing-the-triple-barrier-method" class="nav-link" data-scroll-target="#introducing-the-triple-barrier-method">Introducing the triple barrier method</a>
  <ul class="collapse">
  <li><a href="#intuition-on-consistency" id="toc-intuition-on-consistency" class="nav-link" data-scroll-target="#intuition-on-consistency">Intuition on consistency</a></li>
  <li><a href="#intuition-on-barrier-heights" id="toc-intuition-on-barrier-heights" class="nav-link" data-scroll-target="#intuition-on-barrier-heights">Intuition on barrier heights</a></li>
  </ul></li>
  <li><a href="#implementation-on-r" id="toc-implementation-on-r" class="nav-link" data-scroll-target="#implementation-on-r">Implementation on R</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="contents" class="level2">
<h2 class="anchored" data-anchor-id="contents">Contents</h2>
<ol type="1">
<li><a href="#introducing-the-triple-barrier-method">Introducing the triple barrier method</a>
<ol type="1">
<li><a href="#intuition-on-consistency">Intuition on consistency</a></li>
<li><a href="#intuition-on-barrier-heights">Intuition on barrier heights</a>(#intuition-on-barrier-heights</li>
</ol></li>
<li><a href="#implementation-on-r">Implementation on R</a></li>
<li><a href="#references">References</a></li>
</ol>
<p>There are some existing posts/articles about the triple barrier method. They are not very detailed, and I will write a quite indepth one here. So, I will go over the method very exhaustively. I hope that you can just <code>Ctrl + F</code> (or <code>Cmd + F</code> on Mac) to find the part that you are interested in.</p>
</section>
<section id="introducing-the-triple-barrier-method" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-triple-barrier-method">Introducing the triple barrier method</h2>
<p>The triple barrier method is a method to label data for asset price prediction. The method is coined by <a href="#a1">De Prado (2018)</a>, and it has been gaining popularity in the quantitative finance community. The method may seem foreign for the academic community, but it is actually what day traders have been doing manually for a long time. When a day trader places an order, they set a certain price point to trigger automatically to either take their profit or stop their loss.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://forexspringboard.com/wp-content/uploads/2022/10/what-is-stop-loss-and-take-profit-in-forex.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Example of a stop loss and take profit order, explained on <a href="https://forexspringboard.com/stop-loss-and-take-profit-in-forex/">Forex Springboard</a></figcaption><p></p>
</figure>
</div>
<p>Above you can see the 2 horizontal barriers that are placed to trigger exit orders. You may ask where is <strong>third</strong> barrier of the triple barrier method. The third barrier will be a vertical barrier, which is the time horizon <span class="math inline">\(h\)</span>. The time horizon is the maximum time that the position can be held. The label <span class="math inline">\(y_t\)</span> for a given time <span class="math inline">\(t\)</span> is defined as follows:</p>
<p><span class="math display">\[
y_t=\left\{\begin{array}{cl}
-1 &amp; \text { if hit upper barrier } \\
0 &amp; \text { if hit vertical barrier } \\
1 &amp; \text { if hit lower barrier }
\end{array}\right.
\]</span></p>
<section id="intuition-on-consistency" class="level3">
<h3 class="anchored" data-anchor-id="intuition-on-consistency">Intuition on consistency</h3>
<p>Now, let me wear my statistician hat and make some remarks. After we have our labels, we want to believe that the label <span class="math inline">\(y_t\)</span> for time <span class="math inline">\(t\)</span> is depends on some conditional probability distribution <span class="math inline">\(f(y_t|x_t)\)</span> for given futures <span class="math inline">\(x_t\)</span>. Since, we are constructing our own labels, it relies on <strong>us</strong> to construct sound labels. If some orders trigger profit in 5 minutes and some in 5 days, the labels would not be consistent. By consistency, I mean that we should expect to have similar market conditions for each label class. Our predictive futures <span class="math inline">\(x_t\)</span> captures the market conditions at time <span class="math inline">\(t\)</span>. If the market conditions are drastically different for each label class, the conditional probability distribution <span class="math inline">\(f(y_t|x_t)\)</span> would not have much predictive power.</p>
</section>
<section id="intuition-on-barrier-heights" class="level3">
<h3 class="anchored" data-anchor-id="intuition-on-barrier-heights">Intuition on barrier heights</h3>
<p>There are other variants of the triple barrier method with dynamic barriers, but for the vanilla version, the barriers are static. Thus, in order to implement you need to have 3 ingredients for each time <span class="math inline">\(t\)</span>:</p>
<ul>
<li>upper barrier <span class="math inline">\(u_t\)</span>,</li>
<li>lower barrier <span class="math inline">\(l_t\)</span>, and</li>
<li>horizon <span class="math inline">\(h_t\)</span>.</li>
</ul>
<p>In practice, you can not have a fixed horizon <span class="math inline">\(h_t\)</span> for each time <span class="math inline">\(t\)</span>, since markets are not 7/24 open. Based on the resolution of your data, you can either filter out the entry points that does not fit your time horizon, or you can use the maximum possible time horizon <span class="math inline">\(h_t = \max\{ h^{\text{max}}, h_t^* \}\)</span>, where <span class="math inline">\(h_t^*\)</span> is the remaining time that the market closes</p>
<p>To calculate the upper and lower barriers, you can either use a (1) fixed value, or you can use a (2) volatility based value to calculate the barriers. I have seen cases where both methods are viable. The interpreatation of the both cases are crucial when you are in the feature engineering stage. Case (2) is scaled by the volatility, so may think of it as the effect of the volatility is removed. This could be advantageous if the trends in the market are volatility independent. Case (1) is sensitive to the volatility, so it may be more suitable if the trends in the market are volatility dependent. I usually use both cases and see which one performs better, but the crucial part is to interpret the labels correctly.</p>
<p>For Case (2), I have seen many people estimating volatility using prices, but I think it is better to use returns. Moreover, I also do not advise using the built-in standard deviation functions in your programming language. I take the square of the returns, and then I use the exponential moving average (EMA) to smooth the volatility. Taking the square of the returns means that you are asuming the expected returns are 0, which is how market operates for many assets (e.g.&nbsp;forex). In my experience, I have not seen much difference between using EMA or other moving average functions. The more important part is the span of those moving average functions. I usually use a span of 20, but this is another tuning parameter that you can play with.</p>
<p>Let <span class="math inline">\(\hat{\sigma}_t\)</span> be the estimated volatility of the asset. The upper and lower barriers are calculated as follows:</p>
<p><span class="math display">\[
\begin{aligned}
u_t &amp;= p_t \cdot (1 + \hat{\sigma}_t * \alpha) \\
l_t &amp;= p_t \div (1 + \hat{\sigma}_t * \alpha)
\end{aligned}
\]</span></p>
<p>where I consider <span class="math inline">\(\alpha\)</span> as a tuning parameter. The higher the value of <span class="math inline">\(\alpha\)</span>, the less <span class="math inline">\(1\)</span> and <span class="math inline">\(-1\)</span> labels are generated.</p>
<p>For demonstration, I will code in R, since I am using Quarto to write this article, and it’s aesthetically pleasing to read. Let’s download Nikkei 225 data from Yahoo Finance and see how it works.</p>
</section>
</section>
<section id="implementation-on-r" class="level2">
<h2 class="anchored" data-anchor-id="implementation-on-r">Implementation on R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># download data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="st">"^N225"</span>, <span class="at">from =</span> <span class="st">"2017-01-01"</span>, <span class="at">to =</span> <span class="st">"2017-12-31"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "^N225"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(N225) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"open"</span>, <span class="st">"high"</span>, <span class="st">"low"</span>, <span class="st">"close"</span>, <span class="st">"volume"</span>, <span class="st">"adjusted"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to tibble and drop missing values</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>N225 <span class="ot">&lt;-</span> N225 <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">index</span>(N225)) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, high, low, close) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># drop missing values</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">returns =</span> close <span class="sc">/</span> <span class="fu">lag</span>(close) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">volatility =</span> <span class="fu">EMA</span>(returns <span class="sc">**</span> <span class="dv">2</span>, <span class="dv">20</span>) <span class="sc">**</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">u_bar =</span> close <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> volatility <span class="sc">*</span> alpha), <span class="at">l_bar =</span> close <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> volatility <span class="sc">*</span> alpha)) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># drop missing values</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="co"># convert to tibble</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the data</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(N225)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  date         high    low  close   returns volatility  u_bar  l_bar
  &lt;date&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 2017-02-02 19171. 18867. 18915. -0.0122      0.00993 19478. 18351.
2 2017-02-03 19061. 18831. 18918.  0.000191    0.00944 19454. 18382.
3 2017-02-06 19076. 18899. 18977.  0.00309     0.00903 19491. 18463.
4 2017-02-07 18971. 18805. 18911. -0.00347     0.00866 19402. 18420.
5 2017-02-08 19009. 18876. 19008.  0.00512     0.00839 19486. 18529.
6 2017-02-09 18991. 18875. 18908. -0.00526     0.00814 19369. 18446.</code></pre>
</div>
</div>
<p>Let’s visualize the data. At the moment I am testing out the library <code>rtemis</code>, a library for machine learning and visualization. It’s not on CRAN yet, but you can install it from GitHub.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtemis)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"zac-garland/zgtools"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>colorp <span class="ot">&lt;-</span> <span class="fu">rtpalette</span>(<span class="st">"imperialCol"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(colorp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>colorp[<span class="dv">17</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$lemonYellow
[1] "#FFDD00"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(N225, <span class="at">x =</span> <span class="sc">~</span>date, <span class="at">y =</span> <span class="sc">~</span>close, <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines"</span>, <span class="at">name =</span> <span class="st">"close"</span>, <span class="at">color =</span> <span class="fu">I</span>(colorp[[<span class="dv">24</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>u_bar, <span class="at">mode =</span> <span class="st">"lines"</span>, <span class="at">name =</span> <span class="st">"upper barrier"</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>), <span class="at">color =</span> <span class="fu">I</span>(colorp[[<span class="dv">7</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>l_bar, <span class="at">mode =</span> <span class="st">"lines"</span>, <span class="at">name =</span> <span class="st">"lower barrier"</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>), <span class="at">color =</span> <span class="fu">I</span>(colorp[[<span class="dv">16</span>]])) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Nikkei 225"</span>, <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Price"</span>, <span class="at">type =</span> <span class="st">'log'</span>), <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Date"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8237f8d3e3095a92a285" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8237f8d3e3095a92a285">{"x":{"visdat":{"8ee262dc159":["function () ","plotlyVisDat"]},"cur_data":"8ee262dc159","attrs":{"8ee262dc159":{"x":{},"y":{},"mode":"lines","name":"close","color":["#960078"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"8ee262dc159.1":{"x":{},"y":{},"mode":"lines","name":"upper barrier","color":["#0091D4"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"dash":"dot"},"inherit":true},"8ee262dc159.2":{"x":{},"y":{},"mode":"lines","name":"lower barrier","color":["#EC7300"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"dash":"dot"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Nikkei 225","yaxis":{"domain":[0,1],"automargin":true,"title":"Price","type":"log"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Date"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-05-01","2017-05-02","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-20","2017-11-21","2017-11-22","2017-11-24","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29"],"y":[18914.580078,18918.199219,18976.710938,18910.779297,19007.599609,18907.669922,19378.929688,19459.150391,19238.980469,19437.980469,19347.529297,19234.619141,19251.080078,19381.439453,19379.869141,19371.460938,19283.539063,19107.470703,19118.990234,19393.539063,19564.800781,19469.169922,19379.140625,19344.150391,19254.029297,19318.580078,19604.609375,19633.75,19609.5,19577.380859,19590.140625,19521.589844,19455.880859,19041.380859,19085.310547,19262.529297,18985.589844,19202.869141,19217.480469,19063.220703,18909.259766,18983.230469,18810.25,18861.269531,18597.060547,18664.630859,18797.880859,18747.869141,18552.609375,18426.839844,18335.630859,18355.259766,18418.589844,18432.199219,18430.490234,18620.75,18875.880859,19079.330078,19289.429688,19251.869141,19196.740234,19310.519531,19445.699219,19895.699219,19843,19900.089844,19961.550781,19883.900391,19869.849609,19919.820313,19814.880859,19553.859375,19590.759766,19678.279297,19613.279297,19742.980469,19813.130859,19686.839844,19682.570313,19677.849609,19650.570313,19860.029297,20177.279297,20170.820313,19979.900391,19984.619141,19909.259766,20013.259766,19908.580078,19898.75,19883.519531,19831.820313,19943.259766,20067.75,20230.410156,20138.789063,20110.509766,20132.669922,20153.349609,20225.089844,20130.410156,20220.300781,20033.429688,20055.800781,20032.349609,20081.630859,19994.060547,19929.089844,20080.980469,20195.480469,20098.380859,20099.810547,20118.859375,19999.910156,20020.859375,20144.589844,20099.75,19975.669922,19955.199219,20050.160156,20079.640625,19959.839844,19925.179688,19985.789063,20080.039063,20029.259766,19952.330078,20055.890625,19996.009766,19738.710938,19729.740234,19537.099609,19753.310547,19729.279297,19702.630859,19470.410156,19393.130859,19383.839844,19434.640625,19353.769531,19452.609375,19449.900391,19362.550781,19506.539063,19646.240234,19691.470703,19508.25,19385.810547,19357.970703,19396.519531,19274.820313,19545.769531,19776.619141,19865.820313,19807.439453,19909.5,20299.380859,20310.460938,20347.480469,20296.449219,20397.580078,20330.189453,20267.050781,20363.109375,20356.279297,20400.779297,20614.070313,20626.660156,20628.560547,20690.710938,20823.509766,20881.269531,20954.720703,21155.179688,21255.560547,21336.119141,21363.050781,21448.519531,21457.640625,21696.650391,21805.169922,21707.619141,21739.779297,22008.449219,22011.669922,22011.609375,22420.080078,22539.119141,22548.349609,22937.599609,22913.820313,22868.710938,22681.419922,22380.990234,22380.009766,22028.320313,22351.119141,22396.800781,22261.759766,22416.480469,22523.150391,22550.849609,22495.990234,22486.240234,22597.199219,22724.960938,22819.029297,22707.160156,22622.380859,22177.039063,22498.029297,22811.080078,22938.730469,22866.169922,22758.070313,22694.449219,22553.220703,22901.769531,22868,22891.720703,22866.099609,22902.759766,22939.179688,22892.689453,22911.210938,22783.980469,22764.939453],"mode":"lines","name":"close","type":"scatter","marker":{"color":"rgba(150,0,120,1)","line":{"color":"rgba(150,0,120,1)"}},"textfont":{"color":"rgba(150,0,120,1)"},"error_y":{"color":"rgba(150,0,120,1)"},"error_x":{"color":"rgba(150,0,120,1)"},"line":{"color":"rgba(150,0,120,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-05-01","2017-05-02","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-20","2017-11-21","2017-11-22","2017-11-24","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29"],"y":[19477.8620841131,19454.1002763982,19490.910332524,19401.9622858371,19485.7647340138,19369.3696755343,20013.4102144663,20069.7316542824,19847.5271671432,20051.7202145324,19934.5435268541,19799.3669040966,19788.9383892381,19910.6469736958,19883.2072153174,19850.0864787894,19743.9234549557,19570.47211705,19559.7871284208,19890.8919568484,20068.1480509684,19953.6862013584,19845.3184674864,19787.9529395889,19682.3315453615,19731.7172730085,20085.4947329069,20092.6392439464,20046.0279181381,19992.9833318833,19985.8916646072,19902.0009156002,19821.5671865287,19548.2813584907,19570.2977150058,19756.6992812181,19513.3220321414,19749.8383319019,19738.3237838889,19574.6771993164,19412.1096131627,19468.3040833285,19294.1998737975,19325.2698710977,19094.5967822289,19143.7334663578,19273.371597727,19201.3053376906,19015.3953879326,18879.0902400294,18771.8465853364,18771.0260775257,18819.7646268389,18814.2826236427,18793.8937920895,19012.7141181231,19323.2860146557,19549.7340913106,19782.697330271,19721.4310300637,19645.0021420114,19752.3242938242,19887.2488513063,20500.9712728448,20419.2617714819,20452.3508866596,20491.5605476695,20391.159274681,20352.1832992512,20382.0975267118,20262.8272312823,20037.2484011259,20052.6919485663,20127.0691422854,20042.9604224597,20171.7806191888,20227.607128173,20095.4370089349,20071.1595485883,20047.4088807925,20002.5088354241,20251.0250420632,20658.7559730179,20628.6884054441,20445.4732502822,20427.5934067973,20334.7391107383,20431.440464594,20315.8440468445,20286.0508658351,20251.9037193907,20184.5579770515,20296.257343021,20424.9642491927,20605.0784013029,20503.4663510104,20457.8852395329,20464.0910357472,20469.4992253449,20534.1518616717,20435.7409201002,20523.765921319,20366.8498383471,20373.977090833,20335.41864041,20374.2132762389,20282.6666746796,20209.2085643247,20384.5546808519,20504.834399175,20404.5815848463,20391.089259272,20396.7445188454,20284.5622552849,20292.5956446104,20429.0566484518,20372.8886283147,20257.9866313428,20224.1280497107,20321.9361351502,20339.9701957969,20229.5491780666,20183.2745667965,20238.3835714775,20336.8643024252,20277.402743049,20197.9259972161,20309.7196516323,20242.9928379543,20068.9745700804,20043.8505571499,19881.6640753301,20141.6003874867,20098.8359809062,20054.5381541988,19863.5494135429,19772.3526240796,19744.48137902,19781.7957711214,19690.9528840849,19787.8369639339,19768.7308877755,19675.0068159785,19834.693781619,19986.5329237516,20018.6025122503,19859.3497641631,19736.2735742149,19691.8423218362,19716.7302745535,19597.5358195773,19947.7668290953,20219.8449517345,20297.3622935977,20220.2443085933,20315.4458405374,20838.3046413427,20823.4621953087,20837.535754405,20763.7979306587,20854.1340934783,20767.468464347,20685.7691548638,20773.1324393289,20746.209452369,20774.7738070009,21025.1961593268,21018.1314508894,21000.9624866317,21050.6600071855,21189.63048284,21234.5788234497,21298.8020961361,21535.0233367189,21630.3950317066,21701.755684076,21712.1732698954,21791.2643120064,21783.9039741641,22082.0451368516,22187.1731776711,22080.3575595532,22096.0993941465,22434.053903781,22416.5709531005,22396.7460226295,22956.3640458353,23063.7673642217,23047.6671787556,23544.0827970483,23490.522339369,23417.7684345505,23227.2040134489,22962.1497922514,22932.7792984698,22637.0433392169,23012.2557169909,23028.3758501125,22871.6793430613,23018.2052586875,23106.7262159657,23107.216381885,23026.3389153421,22990.5645343238,23090.2042756145,23211.3244913155,23291.728096279,23166.2989086172,23064.449471168,22754.3511434027,23131.4567252163,23488.9777711612,23597.9489775569,23494.8052526568,23361.4732033831,23269.801399916,23112.3910042451,23533.4967433629,23468.81799858,23464.2276542144,23410.5686477988,23422.596199487,23435.5792068426,23365.8563873615,23361.9734042432,23226.15803465,23185.5516791956],"mode":"lines","name":"upper barrier","type":"scatter","line":{"color":"rgba(0,145,212,1)","dash":"dot"},"marker":{"color":"rgba(0,145,212,1)","line":{"color":"rgba(0,145,212,1)"}},"textfont":{"color":"rgba(0,145,212,1)"},"error_y":{"color":"rgba(0,145,212,1)"},"error_x":{"color":"rgba(0,145,212,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-05-01","2017-05-02","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-20","2017-11-21","2017-11-22","2017-11-24","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15","2017-12-18","2017-12-19","2017-12-20","2017-12-21","2017-12-22","2017-12-25","2017-12-26","2017-12-27","2017-12-28","2017-12-29"],"y":[18351.2980718869,18382.2981616018,18462.511543476,18419.5963081629,18529.4344839862,18445.9701684657,18744.4491615338,18848.5691277176,18630.4337708568,18824.2407234676,18760.5150671459,18669.8713779034,18713.2217667619,18852.2319323042,18876.5310666826,18892.8353972106,18823.1546710443,18644.4692889501,18678.1933395792,18896.1861691516,19061.4535110316,18984.6536426416,18912.9627825136,18900.3478424111,18825.7270486385,18905.4428829915,19123.7240170931,19174.8607560536,19172.9720818619,19161.7783861167,19194.3895853928,19141.1787723998,19090.1945314713,18534.4803595093,18600.3233789942,18768.3593127819,18457.8576558586,18655.8999500981,18696.6371541111,18551.7642066836,18406.4099188373,18498.1568546715,18326.3001262025,18397.2691909023,18099.5243117711,18185.5282516422,18322.390120273,18294.4329443094,18089.8233620674,17974.5894479706,17899.4151326636,17939.4934544743,18017.4150611611,18050.1158143573,18067.0866759105,18228.7858818769,18428.4757033443,18608.9260646894,18796.162045729,18782.3072519363,18748.4783259886,18868.7147681758,19004.1495866937,19290.4271651552,19266.7382285181,19347.8288013404,19431.5410143305,19376.641507319,19387.5159187488,19457.5430992882,19366.9344867177,19070.4703488741,19128.8275834337,19229.4894517146,19183.5981715403,19314.1803188112,19398.654589827,19278.2426790651,19293.9810774117,19308.2903372075,19298.6317905759,19469.0335519368,19695.8026209821,19712.9522205559,19514.3275317178,19541.6448752027,19483.7804212617,19595.079067406,19501.3161091555,19511.4491341649,19515.1353426093,19479.0826489485,19590.262188979,19710.5357508073,19855.7419106971,19774.1117749896,19763.1342924671,19801.2488082528,19837.1999926551,19916.0278263283,19825.0793918998,19916.835640681,19700.0095376529,19737.624471167,19729.28057759,19789.0484417611,19705.4544193204,19648.9711236753,19777.4062571481,19886.126538825,19792.1801331537,19808.531834728,19840.9742311546,19715.2580567151,19749.1231053896,19860.1230395482,19826.6113716853,19693.3532126572,19686.2703882893,19778.3841768498,19819.3110542031,19690.1305099334,19667.0848092035,19733.1945545225,19823.2138235748,19781.116788951,19706.7341587839,19802.0615983677,19749.0266940457,19408.4473059196,19415.6299108501,19192.5351426699,19365.0207065133,19359.7226130938,19350.7235638012,19077.2708984571,19013.9090939204,19023.19830898,19087.4854788786,19016.5861779151,19117.3817860661,19131.0698942245,19050.0947460215,19178.384344381,19305.9475442484,19364.3388937497,19157.1502358369,19035.3475197851,19024.0990841638,19076.3087874465,18952.1048064227,19143.7722329047,19333.3933302655,19434.2783324023,19394.6345974067,19503.5541594626,19760.4570766573,19797.4596806913,19857.425183595,19829.1005073413,19941.0260625217,19892.910441653,19848.3324071362,19953.0863106711,19966.349141631,20026.7847869991,20202.9444666732,20235.1888611106,20256.1586073683,20330.7618688145,20457.38904916,20527.9602385503,20610.6393098639,20775.3360392811,20880.7260622935,20970.482597924,21013.9282921046,21105.7747499936,21131.3772758359,21311.2556451484,21423.1666663289,21334.8807224468,21383.4591998535,21582.844534219,21606.7688908995,21626.4727273705,21883.7961101647,22014.4709177783,22049.0320392444,22331.1164209517,22337.118286631,22319.6534414495,22135.6358305511,21799.8306757486,21827.2402335302,21419.5972867831,21689.9825650091,21765.2257118875,21651.8401889387,21814.7556793125,21939.5745660343,21994.482836115,21965.6415526579,21981.9159336762,22104.1941623855,22238.5973846845,22346.330497721,22248.0214033828,22180.312246832,21599.7269825973,21864.6018687837,22133.1823848388,22279.5119604431,22237.5345913432,22154.6674226169,22119.097038084,21994.0504017549,22270.0423186371,22267.18200142,22319.2137517856,22321.6305702012,22382.923332513,22442.7801691574,22419.5225186385,22460.4484717568,22341.80290335,22344.3272268044],"mode":"lines","name":"lower barrier","type":"scatter","line":{"color":"rgba(236,115,0,1)","dash":"dot"},"marker":{"color":"rgba(236,115,0,1)","line":{"color":"rgba(236,115,0,1)"}},"textfont":{"color":"rgba(236,115,0,1)"},"error_y":{"color":"rgba(236,115,0,1)"},"error_x":{"color":"rgba(236,115,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>label_3plb <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">h =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="dv">1</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize: y, ambiguity</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>ambiguity <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(df) <span class="sc">-</span> h)) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># find first cross</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        u_cross <span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>u_bar[i] <span class="sc">&lt;</span> df<span class="sc">$</span>high[i<span class="sc">:</span>(i <span class="sc">+</span> h)])[<span class="dv">1</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        l_cross <span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>l_bar[i] <span class="sc">&gt;</span> df<span class="sc">$</span>low[i<span class="sc">:</span>(i <span class="sc">+</span> h)])[<span class="dv">1</span>]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(u_cross) <span class="sc">&amp;</span> <span class="fu">is.na</span>(l_cross)) {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>y[i] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.na</span>(u_cross) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(l_cross)) {</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>y[i] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(u_cross) <span class="sc">&amp;</span> <span class="fu">is.na</span>(l_cross)) {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>y[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (u_cross <span class="sc">==</span> l_cross) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>ambiguity[i] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (u_cross <span class="sc">&lt;</span> l_cross) {</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>y[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            df<span class="sc">$</span>y[i] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># label the data</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>N225 <span class="ot">&lt;-</span> <span class="fu">label_3plb</span>(N225, <span class="at">h =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="dv">3</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Number of 1, 0, and -1 labels:"</span>, <span class="fu">sum</span>(N225<span class="sc">$</span>y <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> T), <span class="fu">sum</span>(N225<span class="sc">$</span>y <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> T), <span class="fu">sum</span>(N225<span class="sc">$</span>y <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of 1, 0, and -1 labels: 82 89 46"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Percentage of ambiguity:"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(N225<span class="sc">$</span>ambiguity)) <span class="sc">/</span> <span class="fu">nrow</span>(N225))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Percentage of ambiguity: 0"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop ambiguity and missing values</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>N225 <span class="ot">&lt;-</span> N225 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>ambiguity) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make y column a factor</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>N225<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(N225<span class="sc">$</span>y)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># name the labels | buy, hold, sell</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>N225<span class="sc">$</span>y_n <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(N225<span class="sc">$</span>y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">'Buy'</span>, <span class="fu">ifelse</span>(N225<span class="sc">$</span>y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">'Hold'</span>, <span class="st">'Sell'</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> N225, <span class="at">x =</span> <span class="sc">~</span>date, <span class="at">y =</span> <span class="sc">~</span>close, <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines'</span>, <span class="at">color =</span> <span class="fu">I</span>(<span class="st">'gray'</span>), <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>date, <span class="at">y =</span> <span class="sc">~</span>close, <span class="at">color =</span> <span class="sc">~</span>y_n, <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>, <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">opacity =</span> <span class="fl">0.8</span>), <span class="at">showlegend =</span> T, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">'green'</span>, <span class="st">'black'</span>, <span class="st">'red'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">'Nikkei 225'</span>, <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Date'</span>), <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Price'</span>, <span class="at">type =</span> <span class="st">'log'</span>), <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">'Label'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9205b5e68b3d8f0e0fab" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9205b5e68b3d8f0e0fab">{"x":{"visdat":{"8ee4e28ca6c":["function () ","plotlyVisDat"]},"cur_data":"8ee4e28ca6c","attrs":{"8ee4e28ca6c":{"x":{},"y":{},"mode":"lines","showlegend":false,"color":["gray"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"8ee4e28ca6c.1":{"x":{},"y":{},"mode":"markers","showlegend":true,"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","marker":{"size":10,"opacity":0.8},"colors":["green","black","red"],"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Nikkei 225","xaxis":{"domain":[0,1],"automargin":true,"title":"Date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Price","type":"log"},"legend":{"title":{"text":"Label"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-02-27","2017-02-28","2017-03-01","2017-03-02","2017-03-03","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-10","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-21","2017-03-22","2017-03-23","2017-03-24","2017-03-27","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-03","2017-04-04","2017-04-05","2017-04-06","2017-04-07","2017-04-10","2017-04-11","2017-04-12","2017-04-13","2017-04-14","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-05-01","2017-05-02","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-15","2017-05-16","2017-05-17","2017-05-18","2017-05-19","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-29","2017-05-30","2017-05-31","2017-06-01","2017-06-02","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-26","2017-06-27","2017-06-28","2017-06-29","2017-06-30","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-14","2017-08-15","2017-08-16","2017-08-17","2017-08-18","2017-08-21","2017-08-22","2017-08-23","2017-08-24","2017-08-25","2017-08-28","2017-08-29","2017-08-30","2017-08-31","2017-09-01","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-25","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-06","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-13","2017-11-14","2017-11-15","2017-11-16","2017-11-17","2017-11-20","2017-11-21","2017-11-22","2017-11-24","2017-11-27","2017-11-28","2017-11-29","2017-11-30","2017-12-01","2017-12-04","2017-12-05","2017-12-06","2017-12-07","2017-12-08","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15"],"y":[18914.580078,18918.199219,18976.710938,18910.779297,19007.599609,18907.669922,19378.929688,19459.150391,19238.980469,19437.980469,19347.529297,19234.619141,19251.080078,19381.439453,19379.869141,19371.460938,19283.539063,19107.470703,19118.990234,19393.539063,19564.800781,19469.169922,19379.140625,19344.150391,19254.029297,19318.580078,19604.609375,19633.75,19609.5,19577.380859,19590.140625,19521.589844,19455.880859,19041.380859,19085.310547,19262.529297,18985.589844,19202.869141,19217.480469,19063.220703,18909.259766,18983.230469,18810.25,18861.269531,18597.060547,18664.630859,18797.880859,18747.869141,18552.609375,18426.839844,18335.630859,18355.259766,18418.589844,18432.199219,18430.490234,18620.75,18875.880859,19079.330078,19289.429688,19251.869141,19196.740234,19310.519531,19445.699219,19895.699219,19843,19900.089844,19961.550781,19883.900391,19869.849609,19919.820313,19814.880859,19553.859375,19590.759766,19678.279297,19613.279297,19742.980469,19813.130859,19686.839844,19682.570313,19677.849609,19650.570313,19860.029297,20177.279297,20170.820313,19979.900391,19984.619141,19909.259766,20013.259766,19908.580078,19898.75,19883.519531,19831.820313,19943.259766,20067.75,20230.410156,20138.789063,20110.509766,20132.669922,20153.349609,20225.089844,20130.410156,20220.300781,20033.429688,20055.800781,20032.349609,20081.630859,19994.060547,19929.089844,20080.980469,20195.480469,20098.380859,20099.810547,20118.859375,19999.910156,20020.859375,20144.589844,20099.75,19975.669922,19955.199219,20050.160156,20079.640625,19959.839844,19925.179688,19985.789063,20080.039063,20029.259766,19952.330078,20055.890625,19996.009766,19738.710938,19729.740234,19537.099609,19753.310547,19729.279297,19702.630859,19470.410156,19393.130859,19383.839844,19434.640625,19353.769531,19452.609375,19449.900391,19362.550781,19506.539063,19646.240234,19691.470703,19508.25,19385.810547,19357.970703,19396.519531,19274.820313,19545.769531,19776.619141,19865.820313,19807.439453,19909.5,20299.380859,20310.460938,20347.480469,20296.449219,20397.580078,20330.189453,20267.050781,20363.109375,20356.279297,20400.779297,20614.070313,20626.660156,20628.560547,20690.710938,20823.509766,20881.269531,20954.720703,21155.179688,21255.560547,21336.119141,21363.050781,21448.519531,21457.640625,21696.650391,21805.169922,21707.619141,21739.779297,22008.449219,22011.669922,22011.609375,22420.080078,22539.119141,22548.349609,22937.599609,22913.820313,22868.710938,22681.419922,22380.990234,22380.009766,22028.320313,22351.119141,22396.800781,22261.759766,22416.480469,22523.150391,22550.849609,22495.990234,22486.240234,22597.199219,22724.960938,22819.029297,22707.160156,22622.380859,22177.039063,22498.029297,22811.080078,22938.730469,22866.169922,22758.070313,22694.449219,22553.220703],"mode":"lines","showlegend":false,"type":"scatter","marker":{"color":"rgba(190,190,190,1)","line":{"color":"rgba(190,190,190,1)"}},"textfont":{"color":"rgba(190,190,190,1)"},"error_y":{"color":"rgba(190,190,190,1)"},"error_x":{"color":"rgba(190,190,190,1)"},"line":{"color":"rgba(190,190,190,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2017-02-02","2017-02-03","2017-02-06","2017-02-07","2017-02-08","2017-02-09","2017-02-27","2017-02-28","2017-04-12","2017-04-13","2017-04-14","2017-04-17","2017-04-18","2017-04-19","2017-04-20","2017-04-21","2017-04-24","2017-04-25","2017-04-26","2017-04-27","2017-04-28","2017-05-01","2017-05-02","2017-05-19","2017-05-22","2017-05-23","2017-05-24","2017-05-25","2017-05-26","2017-05-29","2017-05-30","2017-05-31","2017-06-12","2017-06-13","2017-06-14","2017-06-15","2017-06-16","2017-08-24","2017-08-29","2017-08-30","2017-09-04","2017-09-05","2017-09-06","2017-09-07","2017-09-08","2017-09-11","2017-09-12","2017-09-13","2017-09-14","2017-09-15","2017-09-26","2017-09-27","2017-09-28","2017-09-29","2017-10-02","2017-10-03","2017-10-04","2017-10-05","2017-10-06","2017-10-10","2017-10-11","2017-10-12","2017-10-13","2017-10-16","2017-10-17","2017-10-18","2017-10-19","2017-10-20","2017-10-23","2017-10-24","2017-10-25","2017-10-26","2017-10-27","2017-10-30","2017-10-31","2017-11-01","2017-11-02","2017-11-06","2017-11-15","2017-11-20","2017-11-28","2017-12-06"],"y":[18914.580078,18918.199219,18976.710938,18910.779297,19007.599609,18907.669922,19107.470703,19118.990234,18552.609375,18426.839844,18335.630859,18355.259766,18418.589844,18432.199219,18430.490234,18620.75,18875.880859,19079.330078,19289.429688,19251.869141,19196.740234,19310.519531,19445.699219,19590.759766,19678.279297,19613.279297,19742.980469,19813.130859,19686.839844,19682.570313,19677.849609,19650.570313,19908.580078,19898.75,19883.519531,19831.820313,19943.259766,19353.769531,19362.550781,19506.539063,19508.25,19385.810547,19357.970703,19396.519531,19274.820313,19545.769531,19776.619141,19865.820313,19807.439453,19909.5,20330.189453,20267.050781,20363.109375,20356.279297,20400.779297,20614.070313,20626.660156,20628.560547,20690.710938,20823.509766,20881.269531,20954.720703,21155.179688,21255.560547,21336.119141,21363.050781,21448.519531,21457.640625,21696.650391,21805.169922,21707.619141,21739.779297,22008.449219,22011.669922,22011.609375,22420.080078,22539.119141,22548.349609,22028.320313,22261.759766,22486.240234,22177.039063],"mode":"markers","showlegend":true,"type":"scatter","marker":{"color":"rgba(102,194,165,1)","size":10,"opacity":0.8,"line":{"color":"rgba(102,194,165,1)"}},"name":"Buy","textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2017-02-10","2017-02-13","2017-02-14","2017-02-15","2017-02-16","2017-02-17","2017-02-20","2017-02-21","2017-02-22","2017-02-23","2017-02-24","2017-03-01","2017-03-02","2017-03-03","2017-03-06","2017-03-07","2017-03-08","2017-03-09","2017-03-22","2017-03-27","2017-04-06","2017-04-07","2017-05-08","2017-05-09","2017-05-10","2017-05-11","2017-05-12","2017-05-15","2017-05-17","2017-05-18","2017-06-01","2017-06-02","2017-06-05","2017-06-06","2017-06-07","2017-06-08","2017-06-09","2017-06-19","2017-06-20","2017-06-21","2017-06-22","2017-06-23","2017-06-26","2017-06-28","2017-06-30","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-24","2017-07-25","2017-08-14","2017-08-18","2017-08-21","2017-08-22","2017-08-23","2017-08-25","2017-08-28","2017-09-19","2017-09-20","2017-09-21","2017-09-22","2017-09-25","2017-11-13","2017-11-14","2017-11-16","2017-11-17","2017-11-21","2017-11-22","2017-11-24","2017-11-27","2017-11-29","2017-12-07","2017-12-08","2017-12-11","2017-12-12","2017-12-13","2017-12-14","2017-12-15"],"y":[19378.929688,19459.150391,19238.980469,19437.980469,19347.529297,19234.619141,19251.080078,19381.439453,19379.869141,19371.460938,19283.539063,19393.539063,19564.800781,19469.169922,19379.140625,19344.150391,19254.029297,19318.580078,19041.380859,18985.589844,18597.060547,18664.630859,19895.699219,19843,19900.089844,19961.550781,19883.900391,19869.849609,19814.880859,19553.859375,19860.029297,20177.279297,20170.820313,19979.900391,19984.619141,19909.259766,20013.259766,20067.75,20230.410156,20138.789063,20110.509766,20132.669922,20153.349609,20130.410156,20033.429688,20055.800781,20032.349609,20081.630859,19994.060547,19929.089844,20080.980469,20195.480469,20098.380859,20099.810547,20118.859375,19999.910156,20020.859375,20144.589844,20099.75,19975.669922,19955.199219,19537.099609,19470.410156,19393.130859,19383.839844,19434.640625,19452.609375,19449.900391,20299.380859,20310.460938,20347.480469,20296.449219,20397.580078,22380.990234,22380.009766,22351.119141,22396.800781,22416.480469,22523.150391,22550.849609,22495.990234,22597.199219,22498.029297,22811.080078,22938.730469,22866.169922,22758.070313,22694.449219,22553.220703],"mode":"markers","showlegend":true,"type":"scatter","marker":{"color":"rgba(252,141,98,1)","size":10,"opacity":0.8,"line":{"color":"rgba(252,141,98,1)"}},"name":"Hold","textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2017-03-10","2017-03-13","2017-03-14","2017-03-15","2017-03-16","2017-03-17","2017-03-21","2017-03-23","2017-03-24","2017-03-28","2017-03-29","2017-03-30","2017-03-31","2017-04-03","2017-04-04","2017-04-05","2017-04-10","2017-04-11","2017-05-16","2017-06-27","2017-06-29","2017-07-26","2017-07-27","2017-07-28","2017-07-31","2017-08-01","2017-08-02","2017-08-03","2017-08-04","2017-08-07","2017-08-08","2017-08-09","2017-08-10","2017-08-15","2017-08-16","2017-08-17","2017-08-31","2017-09-01","2017-11-07","2017-11-08","2017-11-09","2017-11-10","2017-11-30","2017-12-01","2017-12-04","2017-12-05"],"y":[19604.609375,19633.75,19609.5,19577.380859,19590.140625,19521.589844,19455.880859,19085.310547,19262.529297,19202.869141,19217.480469,19063.220703,18909.259766,18983.230469,18810.25,18861.269531,18797.880859,18747.869141,19919.820313,20225.089844,20220.300781,20050.160156,20079.640625,19959.839844,19925.179688,19985.789063,20080.039063,20029.259766,19952.330078,20055.890625,19996.009766,19738.710938,19729.740234,19753.310547,19729.279297,19702.630859,19646.240234,19691.470703,22937.599609,22913.820313,22868.710938,22681.419922,22724.960938,22819.029297,22707.160156,22622.380859],"mode":"markers","showlegend":true,"type":"scatter","marker":{"color":"rgba(141,160,203,1)","size":10,"opacity":0.8,"line":{"color":"rgba(141,160,203,1)"}},"name":"Sell","textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># blockker</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><span id="a1">[1]</span> De Prado, M. (2018). Advances in financial machine learning. John Wiley &amp; Sons.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>